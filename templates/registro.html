{% extends "base.html" %}
{% block titulo %}Registro · Tests Académicos{% endblock %}

{# Estilos locales para el toggle de contraseña #}
{% block extra_head %}
<style>
  .input-wrap{ position: relative; }
  .input-wrap .input{ padding-right: 46px; } /* espacio para el botón */

  .pass-toggle{
    position: absolute; right: 6px; top: 50%; transform: translateY(-50%);
    width: 36px; height: 36px; display: grid; place-items: center;
    border-radius: 10px; border: 1px solid var(--border);
    background: var(--surface); color: var(--muted); cursor: pointer;
  }
  .pass-toggle:hover{ color: var(--text); }
  .pass-toggle .eye-off{ display: none; }
  .pass-toggle[aria-pressed="true"] .eye{ display: none; }
  .pass-toggle[aria-pressed="true"] .eye-off{ display: block; }
  .pass-toggle svg{ pointer-events: none; }
</style>
{% endblock %}

{% block contenido %}
<section class="container form-wrap">
  <h1 class="section-title">Registro para comenzar</h1>
  <p class="section-subtitle">Crea tu cuenta y completa tus datos. Te tomará menos de 15 minutos.</p>

  {# Mensajes (flash) #}
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="card form-card" style="margin-bottom: 16px;">
        {% for cat, msg in messages %}
          <p style="margin:.25rem 0; color: {{ 'var(--text)' if cat=='ok' else 'tomato' }};">{{ msg }}</p>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- POST directo a /registro; el backend inicia sesión y redirige al inicio -->
  <form id="regForm" action="{{ url_for('registro') }}" method="post" class="card form-card">
    <div class="grid-2">
      <div class="field">
        <label for="name">Nombre completo</label>
        <input class="input" type="text" id="name" name="name" autocomplete="name" required value="{{ request.form.get('name','') }}">
      </div>

      <div class="field">
        <label for="age">Edad</label>
        <input class="input" type="number" id="age" name="age" min="10" max="100" required value="{{ request.form.get('age','') }}">
      </div>

      <div class="field">
        <label for="university">Universidad</label>
        <input class="input" type="text" id="university" name="university" required value="{{ request.form.get('university','') }}">
      </div>

      <div class="field">
        <label for="email">Correo electrónico</label>
        <input class="input" type="email" id="email" name="email" autocomplete="email" required value="{{ request.form.get('email','') }}">
      </div>

      <div class="field">
        <label for="career">Carrera</label>
        <input class="input" type="text" id="career" name="career" placeholder="Ej: Ingeniería de Sistemas" value="{{ request.form.get('career','') }}">
      </div>

      <div class="field">
        <label for="cycle">Ciclo / Semestre</label>
        <input class="input" type="text" id="cycle" name="cycle" placeholder="Ej: 5" value="{{ request.form.get('cycle','') }}">
      </div>

      <div class="field">
        <label for="password">Contraseña</label>
        <div class="input-wrap">
          <input class="input" type="password" id="password" name="password" autocomplete="new-password" minlength="6" required>
          <button type="button" class="pass-toggle" data-target="password" aria-label="Mostrar u ocultar contraseña" aria-pressed="false">
            <!-- ojo -->
            <svg class="eye" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M12 5c-7 0-11 7-11 7s4 7 11 7 11-7 11-7-4-7-11-7zm0 12a5 5 0 110-10 5 5 0 010 10z"/>
            </svg>
            <!-- ojo tachado -->
            <svg class="eye-off" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M2 4.27L3.28 3 21 20.72 19.73 22l-3.2-3.2A12.3 12.3 0 0112 19C5 19 1 12 1 12a21.1 21.1 0 014.67-5.73L2 4.27zM12 7a5 5 0 014.9 6.06l-1.57-1.57A3 3 0 0011 9.1l-1.53-1.53A4.96 4.96 0 0112 7zm-6.38 1.97A18.8 18.8 0 003 12s3 5 9 5c1.2 0 2.3-.2 3.27-.55l-1.66-1.66A4.98 4.98 0 017 12c0-.73.15-1.43.42-2.06z"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="field">
        <label for="password2">Repetir contraseña</label>
        <div class="input-wrap">
          <input class="input" type="password" id="password2" name="password2" autocomplete="new-password" minlength="6" required>
          <button type="button" class="pass-toggle" data-target="password2" aria-label="Mostrar u ocultar contraseña" aria-pressed="false">
            <svg class="eye" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M12 5c-7 0-11 7-11 7s4 7 11 7 11-7 11-7-4-7-11-7zm0 12a5 5 0 110-10 5 5 0 010 10z"/>
            </svg>
            <svg class="eye-off" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M2 4.27L3.28 3 21 20.72 19.73 22l-3.2-3.2A12.3 12.3 0 0112 19C5 19 1 12 1 12a21.1 21.1 0 014.67-5.73L2 4.27zM12 7a5 5 0 014.9 6.06l-1.57-1.57A3 3 0 0011 9.1l-1.53-1.53A4.96 4.96 0 0112 7zm-6.38 1.97A18.8 18.8 0 003 12s3 5 9 5c1.2 0 2.3-.2 3.27-.55l-1.66-1.66A4.98 4.98 0 017 12c0-.73.15-1.43.42-2.06z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Botón centrado -->
    <div class="actions" style="margin-top: .8rem; display:flex; justify-content:center;">
      <button class="btn btn--primary" type="submit">Registrarse</button>
    </div>

    <!-- Aviso centrado -->
    <p class="section-subtitle" style="margin-top:.8rem; text-align:center;">
      ¿Ya tienes cuenta? <a href="{{ url_for('login') }}">Inicia sesión</a>.
    </p>
  </form>
</section>
{% endblock %}

{% block scripts %}
<script>
  // Toggle mostrar/ocultar contraseña
  document.querySelectorAll('.pass-toggle').forEach((btn) => {
    btn.addEventListener('click', () => {
      const id = btn.getAttribute('data-target');
      const input = document.getElementById(id);
      if (!input) return;

      const isText = input.type === 'text';
      input.type = isText ? 'password' : 'text';
      btn.setAttribute('aria-pressed', String(!isText));
    });
  });
</script>
{% endblock %}
