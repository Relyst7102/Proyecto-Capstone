{% extends "base.html" %}
{% block titulo %}Mis tests · Tests Académicos{% endblock %}

{% block contenido %}
<section class="container form-wrap">
  <div class="card form-card">
    <h2 style="margin-top:0;">Mis tests</h2>

    <style>
      /* Tabla limpia y legible */
      .tests-table{width:100%; border-collapse:collapse; table-layout:fixed;}
      .tests-table thead th{
        text-align:left; font-weight:600; color:var(--muted);
        padding:12px 14px; border-bottom:1px solid var(--border);
      }
      .tests-table td{
        padding:12px 14px; border-bottom:1px solid var(--border);
        vertical-align:middle; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
      }
      .tests-table tbody tr:hover{ background:rgba(255,255,255,.03); }
      .tests-table .center{ text-align:center; }
      .tests-table .actions{ text-align:right; white-space:nowrap; }
      .tests-table .score{ font-variant-numeric: tabular-nums; }

      /* Responsive: apilar filas en móvil */
      @media (max-width: 820px){
        .tests-table thead{ display:none; }
        .tests-table, .tests-table tbody, .tests-table tr, .tests-table td{ display:block; width:100%; }
        .tests-table tr{ margin:10px 0; border:1px solid var(--border); border-radius:12px; overflow:hidden; }
        .tests-table td{ border:none; border-top:1px solid var(--border); }
        .tests-table td:first-child{ border-top:none; }
        .tests-table td[data-label]::before{
          content: attr(data-label);
          display:block; font-size:.8rem; color:var(--muted); margin-bottom:4px;
        }
        .tests-table .actions{ text-align:left; padding-top:8px; }
      }
    </style>

    {% if sessions and sessions|length %}
      <table class="tests-table">
        <colgroup>
          <col style="width: 180px;">
          <col>
          <col style="width: 90px;">
          <col style="width: 110px;">
          <col style="width: 160px;">
        </colgroup>
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Test</th>
            <th class="center">Versión</th>
            <th class="center">Puntaje</th>
            <th class="actions">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for s in sessions %}
            {% set total_max = (s.test.questions|length) * (s.test.likert_max or 5) %}
            {% set score = s.score_total if s.score_total is not none else (s.responses|map(attribute='value')|sum) %}
            <tr>
              <td data-label="Fecha">{{ (s.completed_at or s.started_at).strftime("%Y-%m-%d %H:%M") }}</td>
              <td data-label="Test" title="{{ s.test.name }}">{{ s.test.name }}</td>
              <td data-label="Versión" class="center">{{ s.version }}</td>
              <td data-label="Puntaje" class="center score">
                {{ score }}<small style="opacity:.6;"> / {{ total_max }}</small>
              </td>
              <td class="actions" data-label="Acciones">
                <a class="btn btn--sm btn--ghost" href="{{ url_for('resultado', session_id=s.id) }}?from=tests">
                  Ver resultado
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="pending-hint">Aún no has completado ningún test.</p>
    {% endif %}

    <div class="actions" style="margin-top:.9rem;">
      <a class="btn" href="{{ url_for('inicio') }}">Volver</a>
    </div>
  </div>
</section>
{% endblock %}
